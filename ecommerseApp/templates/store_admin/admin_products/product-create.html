{% extends 'store/base.html' %}
{% block content %}
    {% load crispy_forms_tags %}
    <div class="container">
    <h2>Create Product</h2>
    <form method="post" enctype="multipart/form-data" id="product-form">
        {% csrf_token %}

        <!-- Main Product Form -->
        <div class="card mb-4">
            <div class="card-header">Product Information</div>
            <div class="card-body">
                {{ form|crispy }}
            </div>
        </div>

        <!-- Options Section -->
        <div class="card mb-4">
            <div class="card-header">Product Options</div>
            <div class="card-body">
                {{ option_formset.management_form }}
                <div id="options-formset">
                    {% for form in option_formset %}
                    <div class="option-form mb-3 p-3 border rounded">
                        {{ form|crispy }}
                        <!-- Option Values would go here -->
                    </div>
                    {% endfor %}
                </div>
                <button type="button" class="btn btn-sm btn-outline-secondary" id="add-option">
                    <i class="fas fa-plus"></i> Add Option
                </button>
            </div>
        </div>

        <!-- Variants Section -->
        <div class="card mb-4">
            <div class="card-header">Product Variants</div>
            <div class="card-body">
                {{ variant_formset.management_form }}
                <div id="variants-formset">
                    {% for form in variant_formset %}
                    <div class="variant-form mb-3 p-3 border rounded">
                        {{ form|crispy }}
                    </div>
                    {% endfor %}
                </div>
                <button type="button" class="btn btn-sm btn-outline-secondary" id="add-variant">
                    <i class="fas fa-plus"></i> Add Variant
                </button>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Save Product</button>
    </form>
</div>

    <script>

document.addEventListener('DOMContentLoaded', function() {

    document.getElementById('add-option').addEventListener('click', function() {
        const formCount = document.getElementById('id_options-TOTAL_FORMS');
        const formContainer = document.getElementById('options-formset');
        const newForm = formContainer.querySelector('.option-form').cloneNode(true);
        
        const newIndex = parseInt(formCount.value);
        newForm.innerHTML = newForm.innerHTML.replace(/options-\d+-/g, `options-${newIndex}-`);
        newForm.innerHTML = newForm.innerHTML.replace(/id_options-\d+-/g, `id_options-${newIndex}-`);
        
        const inputs = newForm.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            if (input.type !== 'hidden') input.value = '';
            if (input.type === 'checkbox') input.checked = false;
        });
        
        formContainer.appendChild(newForm);
        formCount.value = newIndex + 1;
    });
    
    document.getElementById('add-variant').addEventListener('click', function() {
        const formCount = document.getElementById('id_variants-TOTAL_FORMS');
        const formContainer = document.getElementById('variants-formset');
        const newForm = formContainer.querySelector('.variant-form').cloneNode(true);
        
        const newIndex = parseInt(formCount.value);
        newForm.innerHTML = newForm.innerHTML.replace(/variants-\d+-/g, `variants-${newIndex}-`);
        newForm.innerHTML = newForm.innerHTML.replace(/id_variants-\d+-/g, `id_variants-${newIndex}-`);
        
        const inputs = newForm.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            if (input.type !== 'hidden') input.value = '';
            if (input.type === 'checkbox') input.checked = false;
        });
        
        formContainer.appendChild(newForm);
        formCount.value = newIndex + 1;
    });
});
    </script>
    
{% endblock %}




{#	<div class="container mt-2">#}
{#    <fieldset class="form-group">#}
{#        <form method="post" enctype="multipart/form-data">#}
{#            {% csrf_token %}#}
{#            {{ form|crispy }}#}
{#            <button type="submit" class="btn btn-info mt-2">Create</button>#}
{#        </form>#}
{#    </fieldset>#}
{#    </div>#}
