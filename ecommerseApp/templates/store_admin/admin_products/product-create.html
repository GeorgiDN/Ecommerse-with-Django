{% extends 'store/base.html' %}
{% block content %}
    {% load crispy_forms_tags %}
    
    <div class="container">
    <h2>Create Product</h2>
    <form method="post" enctype="multipart/form-data" id="product-form">
        {% csrf_token %}
        
        <!-- Main Product Form -->
        <div class="card mb-4">
            <div class="card-header">Product Information</div>
            <div class="card-body">
                {{ form|crispy }}
            </div>
        </div>
        
        <!-- Options Section -->
        <div class="card mb-4">
            <div class="card-header">Product Options</div>
            <div class="card-body">
                {{ option_formset.management_form }}
                <div id="options-formset">
                    {% for form in option_formset %}
                    <div class="option-form mb-3 p-3 border rounded">
                        {{ form|crispy }}
                    </div>
                    {% endfor %}
                </div>
                <button type="button" class="btn btn-sm btn-outline-secondary" id="add-option">
                    <i class="fas fa-plus"></i> Add Option
                </button>
            </div>
        </div>
        
        <!-- Variants Section -->
        <div class="card mb-4">
            <div class="card-header">Product Variants</div>
            <div class="card-body">
                {{ variant_formset.management_form }}
                <div id="variants-formset">
                    {% for form in variant_formset %}
                    <div class="variant-form mb-3 p-3 border rounded">
                        {{ form|crispy }}
                    </div>
                    {% endfor %}
                </div>
                <button type="button" class="btn btn-sm btn-outline-secondary" id="add-variant">
                    <i class="fas fa-plus"></i> Add Variant
                </button>
            </div>
        </div>
        
        <button type="submit" class="btn btn-primary">Save Product</button>
    </form>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Select2 for option values
    $('.select2-multiple').select2({
        placeholder: "Select option values",
        allowClear: true
    });

    // Add more option forms
    document.getElementById('add-option').addEventListener('click', function() {
        const formCount = document.getElementById('id_options-TOTAL_FORMS');
        const formContainer = document.getElementById('options-formset');
        const newForm = formContainer.querySelector('.option-form').cloneNode(true);
        
        const newIndex = parseInt(formCount.value);
        newForm.innerHTML = newForm.innerHTML.replace(/options-(\d+)-/g, `options-${newIndex}-`);
        newForm.innerHTML = newForm.innerHTML.replace(/id_options-(\d+)-/g, `id_options-${newIndex}-`);
        
        // Clear values
        const inputs = newForm.querySelectorAll('input');
        inputs.forEach(input => {
            input.value = '';
            if (input.type === 'checkbox') input.checked = false;
        });
        
        formContainer.appendChild(newForm);
        formCount.value = newIndex + 1;
    });

    // Add more variant forms
    document.getElementById('add-variant').addEventListener('click', function() {
        const formCount = document.getElementById('id_variants-TOTAL_FORMS');
        const formContainer = document.getElementById('variants-formset');
        const newForm = formContainer.querySelector('.variant-form').cloneNode(true);
        
        const newIndex = parseInt(formCount.value);
        newForm.innerHTML = newForm.innerHTML.replace(/variants-(\d+)-/g, `variants-${newIndex}-`);
        newForm.innerHTML = newForm.innerHTML.replace(/id_variants-(\d+)-/g, `id_variants-${newIndex}-`);
        
        // Clear values and reinitialize Select2
        const inputs = newForm.querySelectorAll('input, select');
        inputs.forEach(input => {
            if (input.type !== 'hidden') {
                input.value = '';
                if (input.type === 'checkbox') input.checked = false;
            }
        });
        
        formContainer.appendChild(newForm);
        formCount.value = newIndex + 1;
        
        // Reinitialize Select2 for the new form
        $('.select2-multiple').select2();
    });
});
</script>
{% endblock %}
    
    
{#    <div class="container">#}
{#    <h2>Create Product</h2>#}
{#    <form method="post" enctype="multipart/form-data" id="product-form">#}
{#        {% csrf_token %}#}
{#        #}
{#        <!-- Main Product Form -->#}
{#        <div class="card mb-4">#}
{#            <div class="card-header">Product Information</div>#}
{#            <div class="card-body">#}
{#                {{ form|crispy }}#}
{#            </div>#}
{#        </div>#}
{#        #}
{#        <!-- Options Section -->#}
{#        <div class="card mb-4">#}
{#            <div class="card-header">Product Options</div>#}
{#            <div class="card-body">#}
{#                {{ option_formset.management_form }}#}
{#                <div id="options-formset">#}
{#                    {% for form in option_formset %}#}
{#                    <div class="option-form mb-3 p-3 border rounded">#}
{#                        {{ form|crispy }}#}
{#                        #}
{#                        {% if form.option_value_formset %}#}
{#                        <div class="option-values ms-4">#}
{#                            <h6>Option Values</h6>#}
{#                            {{ form.option_value_formset.management_form }}#}
{#                            <div class="value-formset">#}
{#                                {% for value_form in form.option_value_formset %}#}
{#                                <div class="value-form mb-2">#}
{#                                    {{ value_form.as_p }}#}
{#                                </div>#}
{#                                {% endfor %}#}
{#                            </div>#}
{#                            <button type="button" class="btn btn-sm btn-outline-secondary add-value" #}
{#                                    data-option-index="{{ forloop.counter0 }}">#}
{#                                <i class="fas fa-plus"></i> Add Value#}
{#                            </button>#}
{#                        </div>#}
{#                        {% endif %}#}
{#                    </div>#}
{#                    {% endfor %}#}
{#                </div>#}
{#                <button type="button" class="btn btn-sm btn-outline-secondary" id="add-option">#}
{#                    <i class="fas fa-plus"></i> Add Option#}
{#                </button>#}
{#            </div>#}
{#        </div>#}
{#        #}
{#        <!-- Variants Section -->#}
{#        <div class="card mb-4">#}
{#            <div class="card-header">Product Variants</div>#}
{#            <div class="card-body">#}
{#                {{ variant_formset.management_form }}#}
{#                <div id="variants-formset">#}
{#                    {% for form in variant_formset %}#}
{#                    <div class="variant-form mb-3 p-3 border rounded">#}
{#                        {{ form|crispy }}#}
{#                    </div>#}
{#                    {% endfor %}#}
{#                </div>#}
{#                <button type="button" class="btn btn-sm btn-outline-secondary" id="add-variant">#}
{#                    <i class="fas fa-plus"></i> Add Variant#}
{#                </button>#}
{#            </div>#}
{#        </div>#}
{#        #}
{#        <button type="submit" class="btn btn-primary">Save Product</button>#}
{#    </form>#}
{#</div>#}
{#    #}
    
{#    <div class="container">#}
{#    <h2>Create Product</h2>#}
{#    <form method="post" enctype="multipart/form-data" id="product-form">#}
{#        {% csrf_token %}#}
{##}
{#        <!-- Main Product Form -->#}
{#        <div class="card mb-4">#}
{#            <div class="card-header">Product Information</div>#}
{#            <div class="card-body">#}
{#                {{ form|crispy }}#}
{#            </div>#}
{#        </div>#}
{##}
{#        <!-- Options Section -->#}
{#        <div class="card mb-4">#}
{#            <div class="card-header">Product Options</div>#}
{#            <div class="card-body">#}
{#                {{ option_formset.management_form }}#}
{#                <div id="options-formset">#}
{#                    {% for form in option_formset %}#}
{#                    <div class="option-form mb-3 p-3 border rounded">#}
{#                        {{ form|crispy }}#}
{#                        <!-- Option Values would go here -->#}
{#                    </div>#}
{#                    {% endfor %}#}
{#                </div>#}
{#                <button type="button" class="btn btn-sm btn-outline-secondary" id="add-option">#}
{#                    <i class="fas fa-plus"></i> Add Option#}
{#                </button>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <!-- Variants Section -->#}
{#        <div class="card mb-4">#}
{#            <div class="card-header">Product Variants</div>#}
{#            <div class="card-body">#}
{#                {{ variant_formset.management_form }}#}
{#                <div id="variants-formset">#}
{#                    {% for form in variant_formset %}#}
{#                    <div class="variant-form mb-3 p-3 border rounded">#}
{#                        {{ form|crispy }}#}
{#                    </div>#}
{#                    {% endfor %}#}
{#                </div>#}
{#                <button type="button" class="btn btn-sm btn-outline-secondary" id="add-variant">#}
{#                    <i class="fas fa-plus"></i> Add Variant#}
{#                </button>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <button type="submit" class="btn btn-primary">Save Product</button>#}
{#    </form>#}
{#</div>#}

{#    <script>#}
{#document.addEventListener('DOMContentLoaded', function() {#}
{#    // Add more option forms#}
{#    document.getElementById('add-option').addEventListener('click', function() {#}
{#        const formCount = document.getElementById('id_options-TOTAL_FORMS');#}
{#        const formContainer = document.getElementById('options-formset');#}
{#        const newForm = formContainer.querySelector('.option-form').cloneNode(true);#}
{#        #}
{#        const newIndex = parseInt(formCount.value);#}
{#        const newPrefix = `options-${newIndex}-`;#}
{#        #}
{#        // Update the main option form#}
{#        newForm.innerHTML = newForm.innerHTML.replace(/options-\d+-/g, newPrefix);#}
{#        newForm.innerHTML = newForm.innerHTML.replace(/id_options-\d+-/g, `id_${newPrefix}`);#}
{#        #}
{#        // Clear values and update IDs for option values#}
{#        const valueForms = newForm.querySelectorAll('.value-form');#}
{#        valueForms.forEach((form, i) => {#}
{#            form.innerHTML = form.innerHTML.replace(/option_\d+_values/g, `option_${newIndex}_values`);#}
{#            form.innerHTML = form.innerHTML.replace(/id_option_\d+_values/g, `id_option_${newIndex}_values`);#}
{#            form.querySelectorAll('input, select').forEach(input => {#}
{#                input.value = '';#}
{#                if (input.type === 'checkbox') input.checked = false;#}
{#            });#}
{#        });#}
{#        #}
{#        // Update the add value button#}
{#        const addValueBtn = newForm.querySelector('.add-value');#}
{#        if (addValueBtn) {#}
{#            addValueBtn.dataset.optionIndex = newIndex;#}
{#        }#}
{#        #}
{#        formContainer.appendChild(newForm);#}
{#        formCount.value = newIndex + 1;#}
{#    });#}
{##}
{#    // Add more value forms to an option#}
{#    document.addEventListener('click', function(e) {#}
{#        if (e.target.classList.contains('add-value')) {#}
{#            const optionIndex = e.target.dataset.optionIndex;#}
{#            const formContainer = e.target.closest('.option-values').querySelector('.value-formset');#}
{#            const formCount = document.getElementById(`id_option_${optionIndex}_values-TOTAL_FORMS`);#}
{#            #}
{#            const newForm = formContainer.querySelector('.value-form').cloneNode(true);#}
{#            const newIndex = parseInt(formCount.value);#}
{#            const newPrefix = `option_${optionIndex}_values-${newIndex}-`;#}
{#            #}
{#            newForm.innerHTML = newForm.innerHTML.replace(/option_\d+_values-\d+-/g, newPrefix);#}
{#            newForm.innerHTML = newForm.innerHTML.replace(/id_option_\d+_values-\d+-/g, `id_${newPrefix}`);#}
{#            #}
{#            newForm.querySelectorAll('input').forEach(input => {#}
{#                input.value = '';#}
{#            });#}
{#            #}
{#            formContainer.appendChild(newForm);#}
{#            formCount.value = newIndex + 1;#}
{#        }#}
{#    });#}
{##}
{#    // Add more variant forms (same as before)#}
{#    document.getElementById('add-variant').addEventListener('click', function() {#}
{#        const formCount = document.getElementById('id_variants-TOTAL_FORMS');#}
{#        const formContainer = document.getElementById('variants-formset');#}
{#        const newForm = formContainer.querySelector('.variant-form').cloneNode(true);#}
{#        #}
{#        const newIndex = parseInt(formCount.value);#}
{#        newForm.innerHTML = newForm.innerHTML.replace(/variants-\d+-/g, `variants-${newIndex}-`);#}
{#        newForm.innerHTML = newForm.innerHTML.replace(/id_variants-\d+-/g, `id_variants-${newIndex}-`);#}
{#        #}
{#        const inputs = newForm.querySelectorAll('input, select, textarea');#}
{#        inputs.forEach(input => {#}
{#            if (input.type !== 'hidden') input.value = '';#}
{#            if (input.type === 'checkbox') input.checked = false;#}
{#        });#}
{#        #}
{#        formContainer.appendChild(newForm);#}
{#        formCount.value = newIndex + 1;#}
{#    });#}

    
{#document.addEventListener('DOMContentLoaded', function() {#}
{##}
{#    document.getElementById('add-option').addEventListener('click', function() {#}
{#        const formCount = document.getElementById('id_options-TOTAL_FORMS');#}
{#        const formContainer = document.getElementById('options-formset');#}
{#        const newForm = formContainer.querySelector('.option-form').cloneNode(true);#}
{#        #}
{#        const newIndex = parseInt(formCount.value);#}
{#        newForm.innerHTML = newForm.innerHTML.replace(/options-\d+-/g, `options-${newIndex}-`);#}
{#        newForm.innerHTML = newForm.innerHTML.replace(/id_options-\d+-/g, `id_options-${newIndex}-`);#}
{#        #}
{#        const inputs = newForm.querySelectorAll('input, select, textarea');#}
{#        inputs.forEach(input => {#}
{#            if (input.type !== 'hidden') input.value = '';#}
{#            if (input.type === 'checkbox') input.checked = false;#}
{#        });#}
{#        #}
{#        formContainer.appendChild(newForm);#}
{#        formCount.value = newIndex + 1;#}
{#    });#}
{#    #}
{#    document.getElementById('add-variant').addEventListener('click', function() {#}
{#        const formCount = document.getElementById('id_variants-TOTAL_FORMS');#}
{#        const formContainer = document.getElementById('variants-formset');#}
{#        const newForm = formContainer.querySelector('.variant-form').cloneNode(true);#}
{#        #}
{#        const newIndex = parseInt(formCount.value);#}
{#        newForm.innerHTML = newForm.innerHTML.replace(/variants-\d+-/g, `variants-${newIndex}-`);#}
{#        newForm.innerHTML = newForm.innerHTML.replace(/id_variants-\d+-/g, `id_variants-${newIndex}-`);#}
{#        #}
{#        const inputs = newForm.querySelectorAll('input, select, textarea');#}
{#        inputs.forEach(input => {#}
{#            if (input.type !== 'hidden') input.value = '';#}
{#            if (input.type === 'checkbox') input.checked = false;#}
{#        });#}
{#        #}
{#        formContainer.appendChild(newForm);#}
{#        formCount.value = newIndex + 1;#}
{#    });#}






{#	<div class="container mt-2">#}
{#    <fieldset class="form-group">#}
{#        <form method="post" enctype="multipart/form-data">#}
{#            {% csrf_token %}#}
{#            {{ form|crispy }}#}
{#            <button type="submit" class="btn btn-info mt-2">Create</button>#}
{#        </form>#}
{#    </fieldset>#}
{#    </div>#}
